<form novalidate (ngSubmit)="submit()" [formGroup]="form">
  <mat-card class="shipping-card">
    <mat-card-header class="center">
      <mat-card-title> <h2> <b> Reporte de seguridad del Paciente </b></h2> </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Fecha del incidente</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="Fecha_Incidente" required>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="validate('Fecha_Incidente')">
              {{ check('Fecha_Incidente') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Hora_Incidente del incidente</mat-label>
            <input matInput type="time" formControlName="Hora_Incidente" required>
            <mat-error *ngIf="validate('Hora_Incidente')">
              {{ check('Hora_Incidente') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Nombre de quien reporta</mat-label>
            <input matInput placeholder="Nombre de quien reporta" formControlName="Nombre_Quien_Reporta" maxlength="50">
            <mat-error *ngIf="validate('Nombre_Quien_Reporta')">
              {{ check('Nombre_Quien_Reporta') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Cargo de quien reporta</mat-label>
            <input matInput placeholder="Cargo de quien reporta" formControlName="Cargo_Quien_Reporta" maxlength="30">
            <mat-error *ngIf="validate('Cargo_Quien_Reporta')">
              {{ check('Cargo_Quien_Reporta') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Empresa a la cual pertenece</mat-label>
            <mat-select formControlName="Empresa" placeholder="Empresa a la cual pertenece" required>
              <mat-option *ngFor="let c of empresas" value={{c.Id}} (click)="sede(c.Id)">{{c.Nombre}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Empresa')">
              {{ check('Empresa') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Sede donde se presento el incidente</mat-label>
            <mat-select formControlName="Sede" placeholder="Sede donde presento el incidente" required>
              <mat-option *ngFor="let c of sedes" value={{c.Id}}>{{c.Nombre}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Sede')">
              {{ check('Sede') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Servicios</mat-label>
            <mat-select formControlName="Servicio" placeholder="Servicio" required>
              <mat-option *ngFor="let c of sedes" value={{c.Id}}>{{c.Nombre}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Servicio')">
              {{ check('Servicio') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Tipo de novedad de seguridad</mat-label>
            <mat-select placeholder="Tipo de novedad de seguridad" formControlName="Tipo_Novedad" required>
              <mat-option *ngFor="let c of novedades" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-error *ngIf="validate('Tipo_Novedad')">
            {{ check('Tipo_Novedad') }}
          </mat-error>
        </div>
      </div>
      <div class="row>">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Nombre completo del paciente</mat-label>
            <input matInput placeholder="Nombre completo del paciente" formControlName="Nombre_Paciente" maxlength="50" required>
            <mat-error *ngIf="validate('Nombre_Paciente')">
              {{ check('Nombre_Paciente') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Tipo de identificación</mat-label>
            <mat-select formControlName="Tipo_Id" placeholder="Tipo de identificación" required>
              <mat-option *ngFor="let c of identificaciones" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Tipo_Id')">
              {{ check('Tipo_Id') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>No. de identificación</mat-label>
            <input matInput placeholder="No. de identificación" formControlName="Numero_Id" maxlength="11" required>
            <mat-error *ngIf="validate('Numero_Id')">
              {{ check('Numero_Id') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Sexo</mat-label>
            <mat-select formControlName="Sexo" placeholder="Sexo" required>
              <mat-option *ngFor="let c of comboService.comboSexo" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-error *ngIf="validate('Sexo')">
            {{ check('Sexo') }}
          </mat-error>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Edad</mat-label>
            <input type="number" matInput placeholder="Edad" formControlName="Edad" required>
          </mat-form-field>
          <mat-error *ngIf="validate('Edad')">
            {{ check('Edad') }}
          </mat-error>
        </div>
      </div>
      <h3>Describa la situacion presentada respondiendo con las siguientes preguntas</h3>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Qué pasó?</mat-label>
            <input matInput placeholder="¿Qué pasó?" formControlName="Preg_Que" required maxlength="300">
            <mat-error *ngIf="validate('Preg_Que')">
              {{ check('Preg_Que') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Cómo pasó?</mat-label>
            <input matInput placeholder="¿Cómo pasó?" formControlName="Preg_Como" required maxlength="500">
            <mat-error *ngIf="validate('Preg_Como')">
              {{ check('Preg_Como') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Hubo testigos?</mat-label>
            <mat-select formControlName="Preg_Hay_Testigos" placeholder="¿Hubo testigos?" required>
              <mat-option *ngFor="let c of comboService.comboSiNo" value={{c.Id}} (click)="viewTestigos(c.Id)">{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Preg_Hay_Testigos')">
              {{ check('Preg_Hay_Testigos') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col" *ngIf="hayTestigos">
          <mat-form-field appearance="outline">
            <mat-label>¿Quién o quienes?</mat-label>
            <mat-chip-list #chipList aria-label="Testigos">
              <mat-chip *ngFor="let testigo of testigos" (removed)="remove(testigo)">
                {{testigo}}
                <button matChipRemove>
                  <mat-icon>cancelar</mat-icon>
                </button>
              </mat-chip>
              <input formControlName="Preg_Quien" placeholder="nuevo.."
                [matChipInputFor]="chipList"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                [matChipInputAddOnBlur]="addOnBlur"
                (matChipInputTokenEnd)="add($event)">
            </mat-chip-list>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Se produjo durante el proceso de atención?</mat-label>
            <mat-select formControlName="Preg_En_Atencion" placeholder="¿Se produjo durante el proceso de atención?" required>
              <mat-option *ngFor="let c of comboService.comboSiNo" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Preg_En_Atencion')">
              {{ check('Preg_En_Atencion') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Fue involuntario?</mat-label>
            <mat-select formControlName="Preg_Involuntario" placeholder="¿Fue involuntario?" required>
              <mat-option *ngFor="let c of comboService.comboSiNo" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Preg_Involuntario')">
              {{ check('Preg_Involuntario') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Generó daño en el paciente?</mat-label>
            <mat-select formControlName="Preg_Genero_Dano" placeholder="¿Generó daño en el Nombre_Paciente?" required>
              <mat-option *ngFor="let c of comboService.comboSiNo" value={{c.Id}} (click)="viewDano(c.Id)">{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Preg_Genero_Dano')">
              {{ check('Preg_Genero_Dano') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col" *ngIf="hayDanos">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>¿Qué daño genero el Nombre_Paciente?</mat-label>
              <input matInput placeholder="¿Qué daño genero el Nombre_Paciente?" formControlName="Preg_Dano_Generado" maxlength="30">
            <mat-error *ngIf="validate('Preg_Dano_Generado')">
              {{ check('Preg_Dano_Generado') }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col" *ngIf="hayDanos">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Severidad del daño</mat-label>
            <mat-select formControlName="Preg_Dano_Severidad" placeholder="Severidad del daño">
              <mat-option *ngFor="let c of comboService.comboSeveridad" value={{c.Id}}>{{c.Descripcion}}</mat-option>
            </mat-select>
            <mat-error *ngIf="validate('Preg_Dano_Severidad')">
              {{ check('Preg_Dano_Severidad') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Accion inmediatamente tomada</mat-label>
            <input matInput placeholder="Accion inmediatamente tomada" formControlName="Accion_Tomada" required maxlength="500">
            <mat-error *ngIf="validate('Accion_Tomada')">
              {{ check('Accion_Tomada') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-label>Adjuntar evidencia (imagen, foto)</mat-label>
          <button type="button" mat-raised-button (click)="fileInput.click()">Seleccionar</button>
          <input hidden (change)="seleccionarImagen($event)" #fileInput accept="image/*" type="file">
          <br>
          <span class="file-name my-3" *ngIf="imagen">Archivo seleccionado: {{imagen?.name}}</span>
        </div>
      </div>
    </mat-card-content>
    <mat-card-actions>
      <div class="row">
        <div class="col">
          <div class="row">
            <div class="col">
              <button class="bg-secondary" type='button' mat-raised-button (click)="goLogin()">Iniciar sesion</button>
            </div>
            <div class="col">
              <button type='button' mat-raised-button color="warn" (click)="cancelar(false)">Cancelar</button>
            </div>
          </div>
        </div>
        <div class="col">
          <button mat-raised-button class="bg-primary" type="submit" style="color: #fff">Enviar</button>
        </div>
      </div>
    </mat-card-actions>
  </mat-card>
</form>
